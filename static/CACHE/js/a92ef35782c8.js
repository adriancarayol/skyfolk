$(document).ready(function(){$('select').material_select();$('ul.tabs').tabs();$('#btn-upload-photo').on('click',function(){$('#upload_photo').toggle();});$('#close_upload_form, #close_upload_zip_form').on('click',function(){$('#upload_photo').toggle();});$('#del-photo').click(AJAX_delete_photo);$("#edit-photo").click(function(){$(this).text(function(i,text){return text==="Editar"?"No editar":"Editar";});$('#wrapper-edit-form').toggle();return false;});$('.tags-content').on('click','blockquote',function(){$(this).nextAll('input').click();});$('#crop-image').on('click',function(){$('#crop-image-preview').show();$('.avatar-form .is-cutted').val('true');});$('#crop-image-preview').find('.close-crop-image').on('click',function(){$('#crop-image-preview').hide();$('.avatar-form .is-cutted').val('false');});$('#crop-image-preview').find('#cut-done').on('click',function(){$('#crop-image-preview').hide();$('.avatar-form .is-cutted').val('true');});$(this).on('keydown',function(e){var key=e.keyCode||e.which;if(key==27){$('#upload_photo').hide();$('#crop-image-preview').hide();$('.avatar-form .is-cutted').val('false');}});$('#tab-messages').find('#message-photo-form').on('submit',function(event){event.preventDefault();var data=$('.form-wrapper').find('#message-photo-form').serialize();AJAX_submit_photo_publication(data,'publication');});});function AJAX_delete_photo(){var _id=$('.photo-body').attr('data-id');$.ajax({url:'/delete/photo/',type:'DELETE',data:{'id':_id,'csrfmiddlewaretoken':csrftoken},dataType:'json',success:function(json){swal({title:"Photo was deleted.",text:json.msg,timer:2500,showConfirmButton:true},function(){window.location.replace('/multimedia/'+json.author+'/');});},error:function(rs,e){swal(rs.responseText+" "+e);}});}
function AJAX_submit_photo_publication(data,type,pks){type=typeof type!=='undefined'?type:"reply";$.ajax({url:'/publication_photo/',type:'POST',dataType:'json',data:data,success:function(data){var response=data.response;if(response==true){}else{swal({title:"",text:"Failed to publish",customClass:'default-div',type:"error"});}
if(type==="reply"){var caja_comentarios=$('#caja-comentario-'+pks[2]);$(caja_comentarios).find('#message-reply').val('');$(caja_comentarios).fadeOut();}else if(type==="publication"){}},error:function(rs,e){swal({title:'¡Ups!',text:'Revisa el contenido de tu mensaje',customClass:'default-div',type:"error"});}}).done(function(){})}
$(document).ready(function(){$('#tab-messages').find('.wrapper').each(function(){var showLimitChar=90;var comment=$(this).find('.wrp-comment');var text=comment.text();var show=$(this).find('.show-more a');text=text.replace(/\s\s+/g,' ');if(text.length<showLimitChar){$(show).css('display','none');}});$("#tab-messages").on('click','.show-more a',function(){var $this=$(this);var $content=$this.parent().prev("div.comment").find(".wrp-comment");var linkText=$this.text().toUpperCase();if(linkText==="+ MOSTRAR MÁS"){linkText="- Mostrar menos";$content.css('height','auto');}else{linkText="+ Mostrar más";$content.css('height','2.6em');}
$this.text(linkText);return false;});$('.fa-expand').on('click',function(){var caja_pub=$(this).closest('.wrapper');expandComment(caja_pub);});function expandComment(caja_pub){var id_pub=$(caja_pub).attr('id').split('-')[1];var commentToExpand=document.getElementById('expand-'+id_pub);$(commentToExpand).fadeToggle("fast");}
$('.cerrar_ampliado').on('click',function(){var expand=$(this).closest('.ampliado');closeExpand(expand);});function closeExpand(expand){var c=$(expand).attr('id').split('-')[1];var toClose=document.getElementById('expand-'+c);$(toClose).hide();}});var UTILS=UTILS||(function(){var _args={};var _showLimitChar=90;return{init:function(args){_args=args;},conn_socket:function(){var ws_scheme=window.location.protocol=="https:"?"wss":"ws";var ws_path=ws_scheme+'://'+window.location.host+window.location.pathname+"stream/";console.log("Connecting to "+ws_path);var socket=new ReconnectingWebSocket(ws_path);socket.onmessage=function(message){console.log("Got message "+message.data);var data=JSON.parse(message.data);if(data.type==="pub"){var content="";content+='  <div class=\"wrapper\" id="pub-'+data.id+'" data-id="'+_args+'">';content+="            <div class=\"box\">";content+='            <span id="check-'+data.id+'" class=\"zoom-pub\"><i class=\"fa fa-expand fa-lg\"><\/i><\/span>';content+="            <!-- Check para ampliar el mensaje... -->";content+='                  <div class=\"ampliado\" id="expand-'+data.id+'">';content+="                      <div class=\"cerrar_ampliado\"><i class=\"fa fa-close\"><\/i><\/div>";content+="                      <div class=\"nombre_image\">";content+="                    <ul>";content+='                      <li><i class="first">'+data.author_first_name+" "+data.author_last_name+'<\/i><\/li>';content+='                      <li><a class=\"name\" href="/profile/'+data.author_username+'">'+data.author_username+'<\/a><\/li>';content+="                    </ul>";content+='                    <div class="usr-img img-responsive"><img src="'+data.avatar_path+'" alt="'+data.author_username+'" width="120" height="120"></div>';content+="                      </div>";content+="                    <div class=\"parrafo comment-tab\">";content+="                     <a href=\"\/profile\/{{ pub.author.username }}\">{{pub.author.username}}<\/a>";content+='                        <a target="_blank">'+data.created+'</a><br><br>';content+=data.content;content+="                    </div>";content+="                      <div class=\"wrapper-reply\">";content+="                        <!-- RESPUESTAS A COMENTARIOS -->";content+="                        <div class=\"comment-reply\">";content+='                        <div class="avatar-reply"><img src="'+data.avatar_path+'" alt="'+data.author_username+'" width="120" height="120"></div>';content+='                            <div class="author-reply"><span class="triangle"> <\/span><a href="/profile/'+data.author_username+'">'+data.author_username+'</a></div>';content+='                              <div class="content-reply">'+data.content+'<\/div>';content+="                        </div>";content+="                    </div>";content+="                  </div>";content+="      <div class=\"image\">";content+='        <div class="usr-img img-responsive"><img src="'+data.avatar_path+'" alt="'+data.author_username+'" width="120" height="120"></div>';content+="      </div>";content+="</div>";content+="";content+="                <div class=\"articulo\">";content+='                  <h2 class="h22"><a href="/profile/'+data.author_username+'" >'+data.author_username+'</a> ha comentado:  </h2>';content+="                  <div class=\"parrafo comment\">";content+='                    <a target="_blank">'+data.created+'<\/a><br>';content+='                      <div class="wrp-comment">'+data.content+'<\/div>';content+="                  </div>";content+='                    <div class="show-more" id="show-comment-'+data.id+'">';content+="                        <a href=\"#\">+ Mostrar más<\/a>";content+="                    </div>";content+="              <!-- OPCIONES DE COMENTARIOS -->";content+="                <div class=\"options_comentarios\" id=\"options-comments\">";content+="                    <ul class=\"opciones\">";content+="        ";content+="                             <li class=\"trash-comment\" title=\"Borrar comentario\"><i class=\"fa fa-trash\"><\/i><\/li>";content+="                            <li title=\"No me gusta\" class=\"fa-stack hate-with-values\" id=\"fa-hate\">";content+="                                <span class=\"hate-comment\">";content+="                                    <i class=\"fa fa-heart fa-stack-1x\"><\/i>";content+="                                    <i class=\"fa fa-bolt fa-stack-1x fa-inverse\"><\/i>";content+="                                    <i class=\"fa hate-value\"> <\/i>";content+="                                </span>";content+="                            </li>";content+="                        <li title=\"¡Me gusta!\" class=\"like-comment\"><i id=\"like-heart\" class=\"fa fa-heart\"> <\/i><\/li>";content+="                       <li title=\"Citar\" class=\"quote-comment\"><i class=\"fa fa-quote-left\">";content+="                       <\/i><\/li>";content+='                       <li title="Responder" class="reply-comment"><i class="fa fa-reply" id="reply-caja-comentario-'+data.id+'"><\/i><\/li>';content+="                       <li title=\"Añadir a mi timeline\" class=\"add-timeline\"><i class=\"fa fa-tag\"> <\/i><\/li>";content+="                    </ul>";content+="                </div>";content+="                </div>";content+="    </div>";var existing=$('#pub-'+data.id);var no_comments=$('#without-comments');var comment_length=data.content.replace(/\s\s+/g,' ');if(existing.length){existing.html(content);}else{$("#messages-wrapper").prepend(content);}
var show=$('div#pub-'+data.id+'').find('#show-comment-'+data.id+'');if($(no_comments).is(':visible')){$(no_comments).fadeOut();}
if(comment_length.length<_showLimitChar){$(show).css('display','none');}}
else{var content="";content+="                <div class=\"wrapper-reply\">";content+="";content+="                <!-- RESPUESTAS A COMENTARIOS -->";content+="";content+="                <div class=\"comment-reply\">";content+='                <div class=\"avatar-reply\"><img src="'+data.avatar_path+'" alt="'+data.author_username+'" width="120" height="120"><\/div>';content+="                    <div class=\"author-reply\">";content+='                      <a href="/profile/'+data.author_username+'">'+data.author_username+'</a>';content+='                      <i class="reply-created">'+data.created+'<\/i>';content+="                    </div>";content+='                      <div class="content-reply">'+data.content+'</div>';content+="                </div>";content+="";content+="                </div>";content+="    </div>";var pub=$('#pub-'+data.parent);$(pub).append(content);}};if(socket.readyState==WebSocket.OPEN)socket.onopen();socket.onclose=function(){console.log("No connected.");};}};}());!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.ReconnectingWebSocket=b()}(this,function(){function a(b,c,d){function l(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!1,!1,b),c}var e={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3};d||(d={});for(var f in e)this[f]="undefined"!=typeof d[f]?d[f]:e[f];this.url=b,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var h,g=this,i=!1,j=!1,k=document.createElement("div");k.addEventListener("open",function(a){g.onopen(a)}),k.addEventListener("close",function(a){g.onclose(a)}),k.addEventListener("connecting",function(a){g.onconnecting(a)}),k.addEventListener("message",function(a){g.onmessage(a)}),k.addEventListener("error",function(a){g.onerror(a)}),this.addEventListener=k.addEventListener.bind(k),this.removeEventListener=k.removeEventListener.bind(k),this.dispatchEvent=k.dispatchEvent.bind(k),this.open=function(b){h=new WebSocket(g.url,c||[]),b||k.dispatchEvent(l("connecting")),(g.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",g.url);var d=h,e=setTimeout(function(){(g.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",g.url),j=!0,d.close(),j=!1},g.timeoutInterval);h.onopen=function(){clearTimeout(e),(g.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onopen",g.url),g.protocol=h.protocol,g.readyState=WebSocket.OPEN,g.reconnectAttempts=0;var d=l("open");d.isReconnect=b,b=!1,k.dispatchEvent(d)},h.onclose=function(c){if(clearTimeout(e),h=null,i)g.readyState=WebSocket.CLOSED,k.dispatchEvent(l("close"));else{g.readyState=WebSocket.CONNECTING;var d=l("connecting");d.code=c.code,d.reason=c.reason,d.wasClean=c.wasClean,k.dispatchEvent(d),b||j||((g.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onclose",g.url),k.dispatchEvent(l("close")));var e=g.reconnectInterval*Math.pow(g.reconnectDecay,g.reconnectAttempts);setTimeout(function(){g.reconnectAttempts++,g.open(!0)},e>g.maxReconnectInterval?g.maxReconnectInterval:e)}},h.onmessage=function(b){(g.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",g.url,b.data);var c=l("message");c.data=b.data,k.dispatchEvent(c)},h.onerror=function(b){(g.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onerror",g.url,b),k.dispatchEvent(l("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(b){if(h)return(g.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","send",g.url,b),h.send(b);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(a,b){"undefined"==typeof a&&(a=1e3),i=!0,h&&h.close(a,b)},this.refresh=function(){h&&h.close()}}return a.prototype.onopen=function(){},a.prototype.onclose=function(){},a.prototype.onconnecting=function(){},a.prototype.onmessage=function(){},a.prototype.onerror=function(){},a.debugAll=!1,a.CONNECTING=WebSocket.CONNECTING,a.OPEN=WebSocket.OPEN,a.CLOSING=WebSocket.CLOSING,a.CLOSED=WebSocket.CLOSED,a});