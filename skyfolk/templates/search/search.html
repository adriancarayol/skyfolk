{% extends 'account/base_search.html' %}
{% comment %}
Template para las busquedas
{% endcomment %}
{% load app_filters %}
{% load avatar_tags %}
{% load humanize %}
{% load highlight %}
{% block title %} <title>Búsqueda en Skyfolk.</title> {% endblock %}
{% block include_files %}
<link rel="stylesheet" href="{{ STATIC_URL }}css/gallery.css">
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/news.css"/>
<!-- Estilos para la galeria de fotos -->
<style>
    .grid {
        margin: 0 auto;
    }
    .grid-item {
        width: 300px;
        margin-bottom: 10px;
        float: left;
    }
</style>
{% endblock %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col l12 m12 s12">
            <ul class="query-options">
                <li class="list-vertical" {% if s == 'all' %}style="border-bottom: 3px solid #1e88e5;"{% endif %}><a href="{% url 'user_profile:category-search' 'all' %}?q={{ q }}">Ensalada de Frutas</a></li>
                <li class="list-vertical" {% if s == 'images' %} style="border-bottom: 3px solid #1e88e5;" {% endif %}><a href="{% url 'user_profile:category-search' 'images' %}?q={{ q }}">Imágenes</a></li>
                <li class="list-vertical" {% if s == 'publications' %} style="border-bottom: 3px solid #1e88e5;" {% endif %}><a href="{% url 'user_profile:category-search' 'publications' %}?q={{ q }}">Publicaciones</a></li>
                <li class="list-vertical" {% if s == 'videos' %} style="border-bottom: 3px solid #1e88e5;" {% endif %}><a href="{% url 'user_profile:category-search' 'videos' %}?q={{ q }}">Videos</a></li>
                <li class="list-vertical" {% if s == 'accounts' %} style="border-bottom: 3px solid #1e88e5;" {% endif %}><a href="{% url 'user_profile:category-search' 'accounts' %}?q={{ q }}">Cuentas</a></li>
                <li class="list-vertical">Más opciones <i class="fa fa-caret-down" aria-hidden="true"></i>
                    <div id="dropdown-search" class="dropdown-options">
                        <ul class="dropdown-ul">
                            <li>Todo</li>
                            <li>Nuevo</li>
                            <li>De todos</li>
                            <li>Personas que sigues</li>
                            <li>Personas que te siguen</li>
                            <li id="search-advanced">Búsqueda avanzada</li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    {% if object_list|length == 0 %}
    <div class="row">
        <div class="col s12">
            <div class="noelements-search" id="search-noelements">
                <h5 class="">Sin resultados :-(</h5>
                <i class="not-query">No se obtuvo ningún resultado para:
                    <b>{{ q }}</b>
                </i>
            </div>
        </div>
    </div>
    {% endif %}
    {% if s == 'all' %}
    <div class="grid">
        {% for item in object_list %}
        {% if item.model_name == 'profile' %}
        <div class="grid-item">
            <div class="personal-card">
                <div class="header">
                    {% if item.object.back_image %}
                    <img class="back-profile-user" src="{{ item.object.back_image.url }}">
                    {% else %}
                    <img class="back-profile-user" src="{{ STATIC_URL }}img/nuevo_back.png">
                    {% endif %}
                    <i class="fa fa-user fa-2x like-him">
                    </i>
                    <div class="bg-user">
                        <div onclick="location.href='/profile/{{ item.username }}'"
                            class="profile-user-bg">{% avatar item.object.user %}</div>
                    </div>
                </div>
                <div class="col s12">
                    <div style="cursor: default" class="name-friend">
                        <a href="{% url "user_profile:profile" username=item.username %}">@{{ item.username }}</a>
                        <p>{{ item.firstname }} {{ item.lastname }}</p>
                    </div>
                </div>
            </div>
        </div>
        {% elif item.model_name == 'publication' %}
        <div class="grid-item">
            <div class="notice-item" style="box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);">
                <div class="col s3 img">
                    {% avatar item.object.author 50 %}
                </div>
                <div class="col s9">
                    <div class="row">
                        <p><a href="/profile/{{ item.author }}">@{{ item.author }}</a> - <i class="fa fa-clock-o" aria-hidden="true"></i> {{ item.pub_date|naturaltime }}
                            <a href="/publication/{{item.object.id}}" title="Ver publicación"><i class="fa fa-plus-square-o right" aria-hidden="true"></i></a></p>
                    </div>
                    <div class="row">
                         <p>{{ item.content|truncatechars_html:"150"|safe }}</p>
                        <br>
                        {% for i in item.object.images.all %}
                        <div class="col s12">
                            <img src="{{ i.image.url }}" alt="{{ item.author }}" width="100%" height="100%" />
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% elif item.model_name == 'photo' %}
        <div class="grid-item image-div tooltipped" data-position="bottom" data-delay="50" data-tooltip="{{ item.description|truncatechars:"150" }}">
            <div class="container-image">
                <div class="principal-content">
                    {% if item.object.tags.all %}
                    <div class="tags-content">
                        {% for tag in item.object.tags.all %}
                        <blockquote
                            onclick="location.href='{% url 'photologue:collection-list' item.author tag.name %}'">{{ tag.name }}</blockquote>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <img class="lazyload" data-src="
                    {% if item.thumbnail %}/media/{{ item.thumbnail }}{% elif item.url_image %}/media/{{ item.url_image }}{% else %}{{ item.external_image }}{% endif %}"
                    alt="{{ item.title }}" title="{{ item.title }}"
                    onclick="location.href='/photo/{{ item.slug }}'">
                </div>
                <div class="col s12 legend-content">
                    <div class="legend-user-image">
                        {% avatar item.object.owner %}
                    </div>
                    <div class="col l8 m8 s8 legend-user-data">
                        <a href="/profile/{{ item.author }}">@{{ item.author }}</a>
                        <i class="photo-title truncate">{{ item.title }}</i>
                        <i class="truncate photo-date"><i class="fa fa-clock-o"
                                aria-hidden="true"></i> {{ item.pub_date|naturaltime }}</i>
                    </div>
                </div>
            </div>
        </div>
        {% endif %} 
        {% endfor %}
    </div>
    {% endif %}
    {% if s == 'accounts' %}
    <div class="row">
        {% for item in object_list %}
        <div class="col l3 m5 s12">
            <div class="personal-card">
                <div class="header">
                    {% if item.object.back_image %}
                    <img class="back-profile-user" src="{{ item.object.back_image.url }}">
                    {% else %}
                    <img class="back-profile-user" src="{{ STATIC_URL }}img/nuevo_back.png">
                    {% endif %}
                    <i class="fa fa-user fa-2x like-him">
                    </i>
                    <div class="bg-user">
                        <div onclick="location.href='/profile/{{ item.username }}'"
                            class="profile-user-bg">{% avatar item.object.user %}</div>
                    </div>
                </div>
                <div class="col s12">
                    <div style="cursor: default" class="name-friend">
                        <a href="{% url "user_profile:profile" username=item.username %}">@{{ item.username }}</a>
                        <p>{{ item.firstname }} {{ item.lastname }}</p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% if s == 'publications' %}
    <div class="row">
        {% for item in object_list %}
        <div class="col l3 m5 s12">
            <div class="col s12 publication-div" style="box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);">
                <div class="col s3">
                    {% avatar item.object.author 50 %}
                </div>
                <div class="col s9">
                    <div class="row">
                        <p><a href="/profile/{{ item.author }}">@{{ item.author }}</a> - <i class="fa fa-clock-o" aria-hidden="true"></i> {{ item.pub_date|naturaltime }}<a href="/publication/{{item.object.id}}" title="Ver publicación"><i class="fa fa-plus-square-o right" aria-hidden="true"></i></a></p>
                    </div>
                    <div class="row">
                         <p>{{ item.content|truncatechars_html:"150"|safe }}</p>
                        <br>
                        {% for i in item.object.images.all %}
                        <div class="col s12">
                            <img src="{{ i.image.url }}" alt="{{ item.author }}" width="100%" height="100%" />
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% if s == 'images' %}
    <div class="row">
        {% for item in object_list %}
        <div class="col l2 m12 s12 image-div tooltipped" data-position="bottom" data-delay="50" data-tooltip="{{ item.description }}">
            <div class="container-image">
                <div class="principal-content">
                    {% if item.object.tags.all %}
                    <div class="tags-content">
                        {% for tag in item.object.tags.all %}
                        <blockquote
                            onclick="location.href='{% url 'photologue:collection-list' item.author tag.name %}'">{{ tag.name }}</blockquote>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <img class="lazyload" data-src="
                    {% if item.thumbnail %}/media/{{ item.thumbnail }}{% elif item.url_image %}/media/{{ item.url_image }}{% else %}{{ item.external_image }}{% endif %}"
                    alt="{{ item.title }}" title="{{ item.title }}"
                    onclick="location.href='/photo/{{ item.slug }}'">
                </div>
                <div class="col s12 legend-content">
                    <div class="legend-user-image">
                        {% avatar item.object.owner %}
                    </div>
                    <div class="col l8 m8 s8 legend-user-data">
                        <a href="/profile/{{ item.author }}">@{{ item.author }}</a>
                        <i class="photo-title truncate">{{ item.title }}</i>
                        <i class="truncate photo-date"><i class="fa fa-clock-o"
                                aria-hidden="true"></i> {{ item.pub_date|naturaltime }}</i>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %} 
    {% if s == 'videos' %}
    <div class="row">
        {% for result in object_list %}
        <div class="col l3 m5 s12">
            <div class="personal-card">
                <div class="col s12">
                    <div class="header">
                        <a href="{{ result.object.get_absolute_url }}">{{ result.author }}</a>
                    </div>
                </div>
                <div class="col s12">
                    <p>
                        <a href="{{ result.object.get_absolute_url }}">{{ result.text }}</a>
                        {{ result.pub_date }}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %} 
    </div>
    {% endif %}
    <div class="row">
        {% if is_paginated %}
    <ul class="pagination center">
        {% if page_obj.has_previous %}
        <li><a href="?page={{ page_obj.previous_page_number }}&q={{ q }}"><i class="material-icons">chevron_left</i></a></li>
        {% else %}
        <li class="disabled"><span><i class="material-icons">chevron_left</i></span></li>
        {% endif %}
        {% for i in paginator.page_range %}
        {% if page_obj.number == i %}
        <li class="active blue darken-1 white-text"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
        {% else %}
        <li class="waves-effect"><a href="?page={{ i }}&q={{ q }}">{{ i }}</a></li>
        {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
        <li><a href="?page={{ page_obj.next_page_number }}&q={{ q }}">
                <i class="material-icons">chevron_right</i>
        </a></li>
        {% else %}
        <li class="disabled"><span>
                <i class="material-icons">chevron_right</i>
        </span></li>
        {% endif %}
    </ul>
    {% endif %}
    </div>
</div>
<script src="{{ STATIC_URL }}js/search.js"></script>
<script src="{{ STATIC_URL }}js/photo_gallery.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}js/masonry.pkgd.min.js"></script>
        <script src="{{ STATIC_URL }}js/imagesloaded.pkgd.min.js"></script> 
        <script>
            var $grid = $('.grid').masonry({
                itemSelector: '.grid-item',
                columnWidth: 300,
                gutter: 10,
                fitWidth: true
            });
            $grid.imagesLoaded().progress( function() {
                $grid.masonry('layout');
            })
        </script>
{% endblock %}
