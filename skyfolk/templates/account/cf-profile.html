{% extends "account/base_cf.html" %}
{% comment %}
	Template para la configuracion del perfil de usuario
{% endcomment %}
{% block additional_files %}
    {% load i18n avatar_tags %}
{% endblock %}
{% block cf-title %}
    <div class="hgroup">
        <h4 class="cn"> Perfil </h4>
        <h6 class="ch"> Cambia datos de tu perfil</h6>
    </div>
{% endblock %}
{% block cf-form %}
    <form id='formulario' method='post' enctype='multipart/form-data' action=''>{% csrf_token %}
        <div class="col l12 m12 s12 wrapper-profilex">
            {% if node_profile.back_image %}
                <div class="col l12 m12 s12 profilex"
                     style="background: url('{{ node_profile.back_image }}') no-repeat center center; background-size: cover;">
            {% else %}
                <div class="col l12 m12 s12 profilex"
                     style="background: url('{{ STATIC_URL }}dist/img/nuevo_back.png') no-repeat center center; background-size: cover;">
            {% endif %}
            <!-- Si el usuario tiene imagen, lo redireccionamos a change -->
            <div id="avatar-profile" title="Imágen de perfil" class="img-profile"
                 style="background-image: url({% avatar_url user_profile %}); background-repeat: no-repeat; background-position: center;
                         background-size: 100% 100%">
                <a title="Eliminar imágenes de perfil" href="{% url 'avatar_delete' %}" class="delete-profile-image"><i
                        class="fa fa-trash"></i></a>
                <a title="Subir imágenes de perfil" href="{% url 'avatar_add' %}" class="add-profile-image"><i
                        class="fa fa-plus"></i></a>
            </div>
            </div>
            <div class="col l12 m12 s12 index-wrapper">
                <div class="row">
                    <div class="row">
                        <div class="red-text">{{ user_form.first_name.errors }}</div>
                        <div class="input-field col s12">
                            <i class="material-icons prefix">perm_identity</i>
                            {{ user_form.first_name }}
                            <label for="id_first_name">{% trans "Name" %}</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="row">
                        <div class="red-text">{{ user_form.last_name.errors }}</div>
                        <div class="input-field col s12">
                            <i class="material-icons prefix">perm_identity</i>
                            {{ user_form.last_name }}
                            <label for="id_last_name">Apellido</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="backimage-usr">
                        <p>{{ perfil_form.backImage.errors }}</p>
                        <p>Elige una imagen de fondo.</p>
                        <p>{{ perfil_form.backImage }}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="row">
                        <div class="red-text">{{ perfil_form.status.errors }}</div>
                        <div class="input-field col s12">
                            <i class="material-icons prefix">insert_emoticon</i>
                            {{ perfil_form.status }}
                            <label for="id_status">Di como te sientes</label>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <button class="btn btn-info right blue darken-1" id="boton-perfil" type="submit">Salvar cambios</button>
        </div>
    </form>
    {% comment %}
		Para evitar cadenas de texto muy largas (a la hora de mostrar el nombre del fichero)
	{% endcomment %}
    <script async>
        jQuery("a").each(function (i, value) {
            var hyperlink = jQuery(value);
            var text = hyperlink.text();

            if (text.length > 25) {
                hyperlink.text(text.substring(0, 21) + "...");
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            $('#avatar-profile').on('click', function () {
                {% if user_profile|has_avatar %}
                    window.location.href = "{% url 'avatar_change' %}";
                {% else %}
                    window.location.href = "{% url 'avatar_add' %}";
                {% endif %}
            });
        });
    </script>
    <script>
        $('.menu-config').find('li:nth-child(1)').css({'background-color': 'rgba(0,0,0,0.1)', 'color': '#1e88e5'});
    </script>
{% endblock %}
