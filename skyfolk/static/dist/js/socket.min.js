var UTILS=UTILS||function(){var a={};return{init:function(b){a=b},conn_socket:function(){var b="https:"==window.location.protocol?"wss":"ws",c=b+"://"+window.location.host+window.location.pathname+"stream/";console.log("Connecting to "+c);var d=new ReconnectingWebSocket(c);d.onmessage=function(b){console.log("Got message "+b.data);var c=JSON.parse(b.data);if("pub"===c.type){if(!c.is_edited){var d="";d+='<div class="row">',d+='<div class="col s12">',c.level>0?d+=' <div class="col s12 wrapper" id="pub-'+c.id+'" data-id="'+a+'" style="min-width: 98% !important;">':d+=' <div class="col s12 wrapper" id="pub-'+c.id+'" data-id="'+a+'">',d+='            <div class="box">',d+='            <span id="check-'+c.id+'" class="top-options zoom-pub tooltipped" data-position="bottom" data-delay="50" data-tooltip="Ver conversación completa"><i class="fa fa-plus-square-o" aria-hidden="true"></i></span>',a!=c.author_id||1!=c.event_type&&3!=c.event_type||(d+='            <span data-id="'+c.id+'" id="edit-comment-content" class="top-options edit-comment tooltipped" data-position="bottom" data-delay="50" data-tooltip="Editar comentario"><i class="fa fa-pencil" aria-hidden="true"></i></span>'),d+='<div class="row">',d+='                <div class="articulo col s12">',d+='<div class="row">',a==c.author_id?d+='      <div class="image col l1 m2 s2" style="box-shadow: 0 1px 5px rgba(129, 199, 132, 1);">':d+='      <div class="image col l1 m2 s2">',d+='        <div class="usr-img img-responsive"><img src="'+c.avatar_path+'" alt="'+c.author_username+'" width="120" height="120"></div>',d+="      </div>",d+='<div class="col l10 m12 s9">',d+='                  <h2 class="h22"><a href="/profile/'+c.author_username+'" >@'+c.author_username+"</a>",c.parent&&(d+='<span class="chip">',d+='<img src="'+c.parent_avatar+'" alt="'+c.author_parent+'">',d+='<i class="fa fa-reply"></i> <a href="/profile/'+c.parent_author+'">@'+c.parent_author+"</a>",d+="</span>"),d+="</h2>",d+='                    <p id="pub-created" class="blue-text text-darken-2">'+c.created+"</p><br>",d+='<div class="row">',d+='                  <div class="parrafo comment">',d+='                      <div class="wrp-comment">'+c.content+"</div>",d+="                  </div>",d+='                    <div class="show-more" id="show-comment-'+c.id+'">',d+='                        <a href="#">+ Mostrar más</a>',d+="                    </div>",d+="                    </div>",c.extra_content&&(d+='<div class="card small">',d+='<div class="card-image">',c.extra_content_image?d+='<img src="'+c.extra_content_image+'">':d+='<img src="/static/dist/img/nuevo_back.png">',d+='<span class="card-title white-text">'+c.extra_content_title+"</span>",d+="</div>",d+='<div class="card-content">',d+="<p>"+c.extra_content_description+"</p>",d+="</div>",d+='<div class="card-action">',d+='<a href="'+c.extra_content_url+'">Ver</a>',d+="</div></div>"),d+="                    </div>",d+="                    </div>",d+="                    </div>",d+="                    </div>",d+='<div class="row">',d+='<div class="divider"></div>',d+='                <div class="options_comentarios" id="options-comments">',d+='                    <ul class="opciones">',a!=c.board_owner_id&&c.author_id!=a||(d+='                             <li class="trash-comment" title="Borrar comentario"><i class="fa fa-trash"></i></li>'),a!=c.author_id&&(d+='                            <li title="No me gusta" class="hate-comment" id="fa-hate">',d+='                                <i class="fa fa-angle-down" aria-hidden="true"></i>',d+='                                <i class="fa hate-value"></i>',d+="                            </li>",d+='                        <li id="like-heart" title="¡Me gusta!" class="like-comment"><i class="fa fa-angle-up" aria-hidden="true"></i><i id="like-value" class="fa"></i></li>'),d+='                       <li title="Añadir a mi skyline" data-id="'+c.id+'" class="add-timeline" id="add_to_skyline"><i class="fa fa-quote-right" aria-hidden="true"> </i></li>',d+='                       <li title="Responder" class="reply-comment"><i class="fa fa-reply" id="reply-caja-comentario-'+c.id+'"></i></li>',d+="                    </ul>",d+="                </div>",d+="                </div>",d+="    </div>",a==c.author_id&&(d+='<div data-user-id="'+c.author_id+'" id="author-controls-'+c.id+'" class="author-controls">',d+='<div class="row">',d+='<div class="col s12">',d+='<form method="post" accept-charset="utf-8">',d+='<input type="hidden" name="csrfmiddlewaretoken" value="'+c.token+'">',d+='<div class="row">',d+='<div class="input-field col s12">',d+='<i class="material-icons prefix">create</i>',d+='<textarea class="materialize-textarea" placeholder="Escribe el contenido del nuevo mensaje" id="id_caption-'+c.id+'" cols="40" maxlength="500" name="content" rows="10" required="required" style="height: 10.9969px;"></textarea>',d+='<label for="id_caption-'+c.id+'">Editar comentario</label></div>',d+='<div class="row">',d+='<button data-id="'+c.id+'" class="waves-effect waves-light btn blue darken-1 right edit-comment-btn" type="button" id="submit_edit_publication">Editar<i class="material-icons right">mode_edit</i></button>',d+="</div></div></form></div></div></div>"),d+='<div class="wrapper-reply">',d+='<div class="hidden" id="caja-comentario-'+c.id+'">',d+='<form class="reply-form" action="" method="post">',d+='<input type="hidden" name="csrfmiddlewaretoken" value="'+c.token+'">',d+='<input id="id_author" name="author" type="hidden" value="'+a+'">',d+='<input id="id_board_owner" name="board_owner" type="hidden" value="'+c.board_owner_id+'">',d+='<input id="id_parent" name="parent" type="hidden">',d+='<div class="row">',d+='<div class="col s12">',d+='<div class="row">',d+='<div class="input-field col s12">',d+='<textarea class="materialize-textarea message-reply" id="message-reply-'+c.id+'" cols="40" maxlength="500" name="content" placeholder="Responder a @'+c.author_username+'" rows="10" required=""></textarea>',d+='<label for="message-reply-'+c.id+'">Escribe tu mensaje aqui...</label>',d+="</div></div></div></div>",d+='<button type="button" id="reply-'+c.id+'" class="waves-effect waves-light btn right blue enviar">Enviar<i class="material-icons right">send</i></button>',d+="</form></div></div>",d+="    </div></div></div>"}var e=$("#pub-"+c.id),f=$("#without-comments");if(e.length)e.find("#pub-created").first().text(c.created),e.find(".wrp-comment").first().text(c.content);else{var g=$("#pub-"+c.parent);if(g.length)if(1==c.level){var h=$(g).find(".children").first();h.length||(h=$(g).find(".wrapper-reply").after('<ul class="children"></ul>')),$(h).prepend(d)}else $(g).after(d);else $("#tab-comentarios").prepend(d)}var i=$("div#pub-"+c.id).find("#show-comment-"+c.id);$(f).is(":visible")&&$(f).fadeOut();var j=$("#pub-"+c.id).find(".wrp-comment");$(j).height()>60?$(j).css("height","2.6em"):$(i).css("display","none")}},d.readyState==WebSocket.OPEN&&d.onopen(),d.onclose=function(){console.log("No connected.")}}}}();