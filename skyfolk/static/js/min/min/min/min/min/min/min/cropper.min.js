!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";function b(a){return"number"==typeof a&&!isNaN(a)}function c(a){return void 0===a}function d(a,c){var d=[];return b(c)&&d.push(c),d.slice.apply(a,d)}function e(a,b){var c=d(arguments,2);return function(){return a.apply(b,c.concat(d(arguments)))}}function f(a){var b=a.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return b&&(b[1]!==u.protocol||b[2]!==u.hostname||b[3]!==u.port)}function g(a){var b="timestamp="+(new Date).getTime();return a+(-1===a.indexOf("?")?"?":"&")+b}function h(a){return a?' crossOrigin="'+a+'"':""}function i(a,b){var c;return a.naturalWidth&&!ia?b(a.naturalWidth,a.naturalHeight):(c=document.createElement("img"),c.onload=function(){b(this.width,this.height)},void(c.src=a.src))}function j(a){var c=[],d=a.rotate,e=a.scaleX,f=a.scaleY;return b(d)&&0!==d&&c.push("rotate("+d+"deg)"),b(e)&&1!==e&&c.push("scaleX("+e+")"),b(f)&&1!==f&&c.push("scaleY("+f+")"),c.length?c.join(" "):"none"}function k(a,b){var c,d,e=ma(a.degree)%180,f=(e>90?180-e:e)*Math.PI/180,g=na(f),h=oa(f),i=a.width,j=a.height,k=a.aspectRatio;return b?(c=i/(h+g/k),d=c/k):(c=i*h+j*g,d=i*g+j*h),{width:c,height:d}}function l(c,d){var e,f,g,h=a("<canvas>")[0],i=h.getContext("2d"),j=0,l=0,m=d.naturalWidth,n=d.naturalHeight,o=d.rotate,p=d.scaleX,q=d.scaleY,r=b(p)&&b(q)&&(1!==p||1!==q),s=b(o)&&0!==o,t=s||r,u=m*ma(p||1),v=n*ma(q||1);return r&&(e=u/2,f=v/2),s&&(g=k({width:u,height:v,degree:o}),u=g.width,v=g.height,e=u/2,f=v/2),h.width=u,h.height=v,t&&(j=-m/2,l=-n/2,i.save(),i.translate(e,f)),s&&i.rotate(o*Math.PI/180),r&&i.scale(p,q),i.drawImage(c,ra(j),ra(l),ra(m),ra(n)),t&&i.restore(),h}function m(b){var c=b.length,d=0,e=0;return c&&(a.each(b,function(a,b){d+=b.pageX,e+=b.pageY}),d/=c,e/=c),{pageX:d,pageY:e}}function n(a,b,c){var d,e="";for(d=b,c+=b;d<c;d++)e+=sa(a.getUint8(d));return e}function o(a){var b,c,d,e,f,g,h,i,j,k,l=new y(a),m=l.byteLength;if(255===l.getUint8(0)&&216===l.getUint8(1))for(j=2;j<m;){if(255===l.getUint8(j)&&225===l.getUint8(j+1)){h=j;break}j++}if(h&&(c=h+4,d=h+10,"Exif"===n(l,c,4)&&(g=l.getUint16(d),((f=18761===g)||19789===g)&&42===l.getUint16(d+2,f)&&(e=l.getUint32(d+4,f))>=8&&(i=d+e))),i)for(m=l.getUint16(i,f),k=0;k<m;k++)if(j=i+12*k+2,274===l.getUint16(j,f)){j+=8,b=l.getUint16(j,f),ia&&l.setUint16(j,1,f);break}return b}function p(a){var b,c=a.replace(Y,""),d=atob(c),e=d.length,f=new w(e),g=new x(f);for(b=0;b<e;b++)g[b]=d.charCodeAt(b);return f}function q(a){var b,c=new x(a),d=c.length,e="";for(b=0;b<d;b++)e+=sa(c[b]);return"data:image/jpeg;base64,"+z(e)}function r(b,c){this.$element=a(b),this.options=a.extend({},r.DEFAULTS,a.isPlainObject(c)&&c),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var s=a(window),t=a(document),u=window.location,v=window.navigator,w=window.ArrayBuffer,x=window.Uint8Array,y=window.DataView,z=window.btoa,A="cropper",B="cropper-modal",C="cropper-hide",D="cropper-hidden",E="cropper-move",F="cropper-crop",G="cropper-disabled",H="mousedown touchstart pointerdown MSPointerDown",I="mousemove touchmove pointermove MSPointerMove",J="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",K="wheel mousewheel DOMMouseScroll",L="dblclick",M="load."+A,N="error."+A,O="resize."+A,P="build."+A,Q="built."+A,R="cropstart."+A,S="cropmove."+A,T="cropend."+A,U="crop."+A,V="zoom."+A,W=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,X=/^data:/,Y=/^data:([^;]+);base64,/,Z=/^data:image\/jpeg.*;base64,/,$="preview",_="action",aa="se",ba="sw",ca="ne",da="nw",ea="crop",fa="move",ga="zoom",ha=a.isFunction(a("<canvas>")[0].getContext),ia=v&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(v.userAgent),ja=Number,ka=Math.min,la=Math.max,ma=Math.abs,na=Math.sin,oa=Math.cos,pa=Math.sqrt,qa=Math.round,ra=Math.floor,sa=String.fromCharCode;r.prototype={constructor:r,init:function(){var a,b=this.$element;if(b.is("img")){if(this.isImg=!0,this.originalUrl=a=b.attr("src"),!a)return;a=b.prop("src")}else b.is("canvas")&&ha&&(a=b[0].toDataURL());this.load(a)},trigger:function(b,c){var d=a.Event(b,c);return this.$element.trigger(d),d},load:function(b){var c,d,e=this.options,h=this.$element;if(b&&(h.one(P,e.build),!this.trigger(P).isDefaultPrevented())){if(this.url=b,this.image={},!e.checkOrientation||!w)return this.clone();if(c=a.proxy(this.read,this),X.test(b))return Z.test(b)?c(p(b)):this.clone();d=new XMLHttpRequest,d.onerror=d.onabort=a.proxy(function(){this.clone()},this),d.onload=function(){c(this.response)},e.checkCrossOrigin&&f(b)&&h.prop("crossOrigin")&&(b=g(b)),d.open("get",b),d.responseType="arraybuffer",d.send()}},read:function(a){var b=this.options,c=o(a),d=this.image,e=0,f=1,g=1;if(c>1)switch(this.url=q(a),c){case 2:f=-1;break;case 3:e=-180;break;case 4:g=-1;break;case 5:e=90,g=-1;break;case 6:e=90;break;case 7:e=90,f=-1;break;case 8:e=-90}b.rotatable&&(d.rotate=e),b.scalable&&(d.scaleX=f,d.scaleY=g),this.clone()},clone:function(){var b,c,d=this.options,e=this.$element,i=this.url,j="";d.checkCrossOrigin&&f(i)&&(j=e.prop("crossOrigin"),j?b=i:(j="anonymous",b=g(i))),this.crossOrigin=j,this.crossOriginUrl=b,this.$clone=c=a("<img"+h(j)+' src="'+(b||i)+'">'),this.isImg?e[0].complete?this.start():e.one(M,a.proxy(this.start,this)):c.one(M,a.proxy(this.start,this)).one(N,a.proxy(this.stop,this)).addClass(C).insertAfter(e)},start:function(){var b=this.$element,c=this.$clone;this.isImg||(c.off(N,this.stop),b=c),i(b[0],a.proxy(function(b,c){a.extend(this.image,{naturalWidth:b,naturalHeight:c,aspectRatio:b/c}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var b,c,d,e=this.options,f=this.$element,g=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=f.parent(),this.$cropper=b=a(r.TEMPLATE),this.$canvas=b.find(".cropper-canvas").append(g),this.$dragBox=b.find(".cropper-drag-box"),this.$cropBox=c=b.find(".cropper-crop-box"),this.$viewBox=b.find(".cropper-view-box"),this.$face=d=c.find(".cropper-face"),f.addClass(D).after(b),this.isImg||g.removeClass(C),this.initPreview(),this.bind(),e.aspectRatio=la(0,e.aspectRatio)||NaN,e.viewMode=la(0,ka(3,qa(e.viewMode)))||0,e.autoCrop?(this.isCropped=!0,e.modal&&this.$dragBox.addClass(B)):c.addClass(D),e.guides||c.find(".cropper-dashed").addClass(D),e.center||c.find(".cropper-center").addClass(D),e.cropBoxMovable&&d.addClass(E).data(_,"all"),e.highlight||d.addClass("cropper-invisible"),e.background&&b.addClass("cropper-bg"),e.cropBoxResizable||c.find(".cropper-line, .cropper-point").addClass(D),this.setDragMode(e.dragMode),this.render(),this.isBuilt=!0,this.setData(e.data),f.one(Q,e.built),this.completing=setTimeout(a.proxy(function(){this.trigger(Q),this.trigger(U,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isCompleted||clearTimeout(this.completing),this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var a=this.options,b=this.$element,c=this.$container,d=this.$cropper;d.addClass(D),b.removeClass(D),d.css(this.container={width:la(c.width(),ja(a.minContainerWidth)||200),height:la(c.height(),ja(a.minContainerHeight)||100)}),b.addClass(D),d.removeClass(D)},initCanvas:function(){var b,c=this.options.viewMode,d=this.container,e=d.width,f=d.height,g=this.image,h=g.naturalWidth,i=g.naturalHeight,j=90===ma(g.rotate),k=j?i:h,l=j?h:i,m=k/l,n=e,o=f;f*m>e?3===c?n=f*m:o=e/m:3===c?o=e/m:n=f*m,b={naturalWidth:k,naturalHeight:l,aspectRatio:m,width:n,height:o},b.oldLeft=b.left=(e-n)/2,b.oldTop=b.top=(f-o)/2,this.canvas=b,this.isLimited=1===c||2===c,this.limitCanvas(!0,!0),this.initialImage=a.extend({},g),this.initialCanvas=a.extend({},b)},limitCanvas:function(a,b){var c,d,e,f,g=this.options,h=g.viewMode,i=this.container,j=i.width,k=i.height,l=this.canvas,m=l.aspectRatio,n=this.cropBox,o=this.isCropped&&n;a&&(c=ja(g.minCanvasWidth)||0,d=ja(g.minCanvasHeight)||0,h&&(h>1?(c=la(c,j),d=la(d,k),3===h&&(d*m>c?c=d*m:d=c/m)):c?c=la(c,o?n.width:0):d?d=la(d,o?n.height:0):o&&(c=n.width,d=n.height,d*m>c?c=d*m:d=c/m)),c&&d?d*m>c?d=c/m:c=d*m:c?d=c/m:d&&(c=d*m),l.minWidth=c,l.minHeight=d,l.maxWidth=1/0,l.maxHeight=1/0),b&&(h?(e=j-l.width,f=k-l.height,l.minLeft=ka(0,e),l.minTop=ka(0,f),l.maxLeft=la(0,e),l.maxTop=la(0,f),o&&this.isLimited&&(l.minLeft=ka(n.left,n.left+n.width-l.width),l.minTop=ka(n.top,n.top+n.height-l.height),l.maxLeft=n.left,l.maxTop=n.top,2===h&&(l.width>=j&&(l.minLeft=ka(0,e),l.maxLeft=la(0,e)),l.height>=k&&(l.minTop=ka(0,f),l.maxTop=la(0,f))))):(l.minLeft=-l.width,l.minTop=-l.height,l.maxLeft=j,l.maxTop=k))},renderCanvas:function(a){var b,c,d=this.canvas,e=this.image,f=e.rotate,g=e.naturalWidth,h=e.naturalHeight;this.isRotated&&(this.isRotated=!1,c=k({width:e.width,height:e.height,degree:f}),(b=c.width/c.height)!==d.aspectRatio&&(d.left-=(c.width-d.width)/2,d.top-=(c.height-d.height)/2,d.width=c.width,d.height=c.height,d.aspectRatio=b,d.naturalWidth=g,d.naturalHeight=h,f%180&&(c=k({width:g,height:h,degree:f}),d.naturalWidth=c.width,d.naturalHeight=c.height),this.limitCanvas(!0,!1))),(d.width>d.maxWidth||d.width<d.minWidth)&&(d.left=d.oldLeft),(d.height>d.maxHeight||d.height<d.minHeight)&&(d.top=d.oldTop),d.width=ka(la(d.width,d.minWidth),d.maxWidth),d.height=ka(la(d.height,d.minHeight),d.maxHeight),this.limitCanvas(!1,!0),d.oldLeft=d.left=ka(la(d.left,d.minLeft),d.maxLeft),d.oldTop=d.top=ka(la(d.top,d.minTop),d.maxTop),this.$canvas.css({width:d.width,height:d.height,left:d.left,top:d.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),a&&this.output()},renderImage:function(b){var c,d=this.canvas,e=this.image;e.rotate&&(c=k({width:d.width,height:d.height,degree:e.rotate,aspectRatio:e.aspectRatio},!0)),a.extend(e,c?{width:c.width,height:c.height,left:(d.width-c.width)/2,top:(d.height-c.height)/2}:{width:d.width,height:d.height,left:0,top:0}),this.$clone.css({width:e.width,height:e.height,marginLeft:e.left,marginTop:e.top,transform:j(e)}),b&&this.output()},initCropBox:function(){var b=this.options,c=this.canvas,d=b.aspectRatio,e=ja(b.autoCropArea)||.8,f={width:c.width,height:c.height};d&&(c.height*d>c.width?f.height=f.width/d:f.width=f.height*d),this.cropBox=f,this.limitCropBox(!0,!0),f.width=ka(la(f.width,f.minWidth),f.maxWidth),f.height=ka(la(f.height,f.minHeight),f.maxHeight),f.width=la(f.minWidth,f.width*e),f.height=la(f.minHeight,f.height*e),f.oldLeft=f.left=c.left+(c.width-f.width)/2,f.oldTop=f.top=c.top+(c.height-f.height)/2,this.initialCropBox=a.extend({},f)},limitCropBox:function(a,b){var c,d,e,f,g=this.options,h=g.aspectRatio,i=this.container,j=i.width,k=i.height,l=this.canvas,m=this.cropBox,n=this.isLimited;a&&(c=ja(g.minCropBoxWidth)||0,d=ja(g.minCropBoxHeight)||0,c=ka(c,j),d=ka(d,k),e=ka(j,n?l.width:j),f=ka(k,n?l.height:k),h&&(c&&d?d*h>c?d=c/h:c=d*h:c?d=c/h:d&&(c=d*h),f*h>e?f=e/h:e=f*h),m.minWidth=ka(c,e),m.minHeight=ka(d,f),m.maxWidth=e,m.maxHeight=f),b&&(n?(m.minLeft=la(0,l.left),m.minTop=la(0,l.top),m.maxLeft=ka(j,l.left+l.width)-m.width,m.maxTop=ka(k,l.top+l.height)-m.height):(m.minLeft=0,m.minTop=0,m.maxLeft=j-m.width,m.maxTop=k-m.height))},renderCropBox:function(){var a=this.options,b=this.container,c=b.width,d=b.height,e=this.cropBox;(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=ka(la(e.width,e.minWidth),e.maxWidth),e.height=ka(la(e.height,e.minHeight),e.maxHeight),this.limitCropBox(!1,!0),e.oldLeft=e.left=ka(la(e.left,e.minLeft),e.maxLeft),e.oldTop=e.top=ka(la(e.top,e.minTop),e.maxTop),a.movable&&a.cropBoxMovable&&this.$face.data(_,e.width===c&&e.height===d?fa:"all"),this.$cropBox.css({width:e.width,height:e.height,left:e.left,top:e.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(U,this.getData())},initPreview:function(){var b,c=h(this.crossOrigin),d=c?this.crossOriginUrl:this.url;this.$preview=a(this.options.preview),this.$clone2=b=a("<img"+c+' src="'+d+'">'),this.$viewBox.html(b),this.$preview.each(function(){var b=a(this);b.data($,{width:b.width(),height:b.height(),html:b.html()}),b.html("<img"+c+' src="'+d+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var b=a(this),c=b.data($);b.css({width:c.width,height:c.height}).html(c.html).removeData($)})},preview:function(){var b=this.image,c=this.canvas,d=this.cropBox,e=d.width,f=d.height,g=b.width,h=b.height,i=d.left-c.left-b.left,k=d.top-c.top-b.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:g,height:h,marginLeft:-i,marginTop:-k,transform:j(b)}),this.$preview.each(function(){var c=a(this),d=c.data($),l=d.width,m=d.height,n=l,o=m,p=1;e&&(p=l/e,o=f*p),f&&o>m&&(p=m/f,n=e*p,o=m),c.css({width:n,height:o}).find("img").css({width:g*p,height:h*p,marginLeft:-i*p,marginTop:-k*p,transform:j(b)})}))},bind:function(){var b=this.options,c=this.$element,d=this.$cropper;a.isFunction(b.cropstart)&&c.on(R,b.cropstart),a.isFunction(b.cropmove)&&c.on(S,b.cropmove),a.isFunction(b.cropend)&&c.on(T,b.cropend),a.isFunction(b.crop)&&c.on(U,b.crop),a.isFunction(b.zoom)&&c.on(V,b.zoom),d.on(H,a.proxy(this.cropStart,this)),b.zoomable&&b.zoomOnWheel&&d.on(K,a.proxy(this.wheel,this)),b.toggleDragModeOnDblclick&&d.on(L,a.proxy(this.dblclick,this)),t.on(I,this._cropMove=e(this.cropMove,this)).on(J,this._cropEnd=e(this.cropEnd,this)),b.responsive&&s.on(O,this._resize=e(this.resize,this))},unbind:function(){var b=this.options,c=this.$element,d=this.$cropper;a.isFunction(b.cropstart)&&c.off(R,b.cropstart),a.isFunction(b.cropmove)&&c.off(S,b.cropmove),a.isFunction(b.cropend)&&c.off(T,b.cropend),a.isFunction(b.crop)&&c.off(U,b.crop),a.isFunction(b.zoom)&&c.off(V,b.zoom),d.off(H,this.cropStart),b.zoomable&&b.zoomOnWheel&&d.off(K,this.wheel),b.toggleDragModeOnDblclick&&d.off(L,this.dblclick),t.off(I,this._cropMove).off(J,this._cropEnd),b.responsive&&s.off(O,this._resize)},resize:function(){var b,c,d,e=this.options.restore,f=this.$container,g=this.container;!this.isDisabled&&g&&(1==(d=f.width()/g.width)&&f.height()===g.height||(e&&(b=this.getCanvasData(),c=this.getCropBoxData()),this.render(),e&&(this.setCanvasData(a.each(b,function(a,c){b[a]=c*d})),this.setCropBoxData(a.each(c,function(a,b){c[a]=b*d})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(F)?this.setDragMode(fa):this.setDragMode(ea))},wheel:function(b){var c=b.originalEvent||b,d=ja(this.options.wheelZoomRatio)||.1,e=1;this.isDisabled||(b.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(a.proxy(function(){this.wheeling=!1},this),50),c.deltaY?e=c.deltaY>0?1:-1:c.wheelDelta?e=-c.wheelDelta/120:c.detail&&(e=c.detail>0?1:-1),this.zoom(-e*d,b)))},cropStart:function(b){var c,d,e=this.options,f=b.originalEvent,g=f&&f.touches,h=b;if(!this.isDisabled){if(g){if((c=g.length)>1){if(!e.zoomable||!e.zoomOnTouch||2!==c)return;h=g[1],this.startX2=h.pageX,this.startY2=h.pageY,d=ga}h=g[0]}if(d=d||a(h.target).data(_),W.test(d)){if(this.trigger(R,{originalEvent:f,action:d}).isDefaultPrevented())return;b.preventDefault(),this.action=d,this.cropping=!1,this.startX=h.pageX||f&&f.pageX,this.startY=h.pageY||f&&f.pageY,d===ea&&(this.cropping=!0,this.$dragBox.addClass(B))}}},cropMove:function(a){var b,c=this.options,d=a.originalEvent,e=d&&d.touches,f=a,g=this.action;if(!this.isDisabled){if(e){if((b=e.length)>1){if(!c.zoomable||!c.zoomOnTouch||2!==b)return;f=e[1],this.endX2=f.pageX,this.endY2=f.pageY}f=e[0]}if(g){if(this.trigger(S,{originalEvent:d,action:g}).isDefaultPrevented())return;a.preventDefault(),this.endX=f.pageX||d&&d.pageX,this.endY=f.pageY||d&&d.pageY,this.change(f.shiftKey,g===ga?a:null)}}},cropEnd:function(a){var b=a.originalEvent,c=this.action;this.isDisabled||c&&(a.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(B,this.isCropped&&this.options.modal)),this.action="",this.trigger(T,{originalEvent:b,action:c}))},change:function(a,b){var c,d,e=this.options,f=e.aspectRatio,g=this.action,h=this.container,i=this.canvas,j=this.cropBox,k=j.width,l=j.height,m=j.left,n=j.top,o=m+k,p=n+l,q=0,r=0,s=h.width,t=h.height,u=!0;switch(!f&&a&&(f=k&&l?k/l:1),this.isLimited&&(q=j.minLeft,r=j.minTop,s=q+ka(h.width,i.width,i.left+i.width),t=r+ka(h.height,i.height,i.top+i.height)),d={x:this.endX-this.startX,y:this.endY-this.startY},f&&(d.X=d.y*f,d.Y=d.x/f),g){case"all":m+=d.x,n+=d.y;break;case"e":if(d.x>=0&&(o>=s||f&&(n<=r||p>=t))){u=!1;break}k+=d.x,f&&(l=k/f,n-=d.Y/2),k<0&&(g="w",k=0);break;case"n":if(d.y<=0&&(n<=r||f&&(m<=q||o>=s))){u=!1;break}l-=d.y,n+=d.y,f&&(k=l*f,m+=d.X/2),l<0&&(g="s",l=0);break;case"w":if(d.x<=0&&(m<=q||f&&(n<=r||p>=t))){u=!1;break}k-=d.x,m+=d.x,f&&(l=k/f,n+=d.Y/2),k<0&&(g="e",k=0);break;case"s":if(d.y>=0&&(p>=t||f&&(m<=q||o>=s))){u=!1;break}l+=d.y,f&&(k=l*f,m-=d.X/2),l<0&&(g="n",l=0);break;case ca:if(f){if(d.y<=0&&(n<=r||o>=s)){u=!1;break}l-=d.y,n+=d.y,k=l*f}else d.x>=0?o<s?k+=d.x:d.y<=0&&n<=r&&(u=!1):k+=d.x,d.y<=0?n>r&&(l-=d.y,n+=d.y):(l-=d.y,n+=d.y);k<0&&l<0?(g=ba,l=0,k=0):k<0?(g=da,k=0):l<0&&(g=aa,l=0);break;case da:if(f){if(d.y<=0&&(n<=r||m<=q)){u=!1;break}l-=d.y,n+=d.y,k=l*f,m+=d.X}else d.x<=0?m>q?(k-=d.x,m+=d.x):d.y<=0&&n<=r&&(u=!1):(k-=d.x,m+=d.x),d.y<=0?n>r&&(l-=d.y,n+=d.y):(l-=d.y,n+=d.y);k<0&&l<0?(g=aa,l=0,k=0):k<0?(g=ca,k=0):l<0&&(g=ba,l=0);break;case ba:if(f){if(d.x<=0&&(m<=q||p>=t)){u=!1;break}k-=d.x,m+=d.x,l=k/f}else d.x<=0?m>q?(k-=d.x,m+=d.x):d.y>=0&&p>=t&&(u=!1):(k-=d.x,m+=d.x),d.y>=0?p<t&&(l+=d.y):l+=d.y;k<0&&l<0?(g=ca,l=0,k=0):k<0?(g=aa,k=0):l<0&&(g=da,l=0);break;case aa:if(f){if(d.x>=0&&(o>=s||p>=t)){u=!1;break}k+=d.x,l=k/f}else d.x>=0?o<s?k+=d.x:d.y>=0&&p>=t&&(u=!1):k+=d.x,d.y>=0?p<t&&(l+=d.y):l+=d.y;k<0&&l<0?(g=da,l=0,k=0):k<0?(g=ba,k=0):l<0&&(g=ca,l=0);break;case fa:this.move(d.x,d.y),u=!1;break;case ga:this.zoom(function(a,b,c,d){var e=pa(a*a+b*b);return(pa(c*c+d*d)-e)/e}(ma(this.startX-this.startX2),ma(this.startY-this.startY2),ma(this.endX-this.endX2),ma(this.endY-this.endY2)),b),this.startX2=this.endX2,this.startY2=this.endY2,u=!1;break;case ea:if(!d.x||!d.y){u=!1;break}c=this.$cropper.offset(),m=this.startX-c.left,n=this.startY-c.top,k=j.minWidth,l=j.minHeight,d.x>0?g=d.y>0?aa:ca:d.x<0&&(m-=k,g=d.y>0?ba:da),d.y<0&&(n-=l),this.isCropped||(this.$cropBox.removeClass(D),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}u&&(j.width=k,j.height=l,j.left=m,j.top=n,this.action=g,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(B),this.$cropBox.removeClass(D)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=a.extend({},this.initialImage),this.canvas=a.extend({},this.initialCanvas),this.cropBox=a.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(a.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(B),this.$cropBox.addClass(D))},replace:function(a,b){!this.isDisabled&&a&&(this.isImg&&this.$element.attr("src",a),b?(this.url=a,this.$clone.attr("src",a),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",a)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(a)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(G))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(G))},destroy:function(){var a=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&a.attr("src",this.originalUrl),this.unbuild(),a.removeClass(D)):this.isImg?a.off(M,this.start):this.$clone&&this.$clone.remove(),a.removeData(A)},move:function(a,b){var d=this.canvas;this.moveTo(c(a)?a:d.left+ja(a),c(b)?b:d.top+ja(b))},moveTo:function(a,d){var e=this.canvas,f=!1;c(d)&&(d=a),a=ja(a),d=ja(d),this.isBuilt&&!this.isDisabled&&this.options.movable&&(b(a)&&(e.left=a,f=!0),b(d)&&(e.top=d,f=!0),f&&this.renderCanvas(!0))},zoom:function(a,b){var c=this.canvas;a=ja(a),a=a<0?1/(1-a):1+a,this.zoomTo(c.width*a/c.naturalWidth,b)},zoomTo:function(a,b){var c,d,e,f,g,h=this.options,i=this.canvas,j=i.width,k=i.height,l=i.naturalWidth,n=i.naturalHeight;if((a=ja(a))>=0&&this.isBuilt&&!this.isDisabled&&h.zoomable){if(d=l*a,e=n*a,b&&(c=b.originalEvent),this.trigger(V,{originalEvent:c,oldRatio:j/l,ratio:d/l}).isDefaultPrevented())return;c?(f=this.$cropper.offset(),g=c.touches?m(c.touches):{pageX:b.pageX||c.pageX||0,pageY:b.pageY||c.pageY||0},i.left-=(d-j)*((g.pageX-f.left-i.left)/j),i.top-=(e-k)*((g.pageY-f.top-i.top)/k)):(i.left-=(d-j)/2,i.top-=(e-k)/2),i.width=d,i.height=e,this.renderCanvas(!0)}},rotate:function(a){this.rotateTo((this.image.rotate||0)+ja(a))},rotateTo:function(a){a=ja(a),b(a)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=a%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(a,d){var e=this.image,f=!1;c(d)&&(d=a),a=ja(a),d=ja(d),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(b(a)&&(e.scaleX=a,f=!0),b(d)&&(e.scaleY=d,f=!0),f&&this.renderImage(!0))},scaleX:function(a){var c=this.image.scaleY;this.scale(a,b(c)?c:1)},scaleY:function(a){var c=this.image.scaleX;this.scale(b(c)?c:1,a)},getData:function(b){var c,d,e=this.options,f=this.image,g=this.canvas,h=this.cropBox;return this.isBuilt&&this.isCropped?(d={x:h.left-g.left,y:h.top-g.top,width:h.width,height:h.height},c=f.width/f.naturalWidth,a.each(d,function(a,e){e/=c,d[a]=b?qa(e):e})):d={x:0,y:0,width:0,height:0},e.rotatable&&(d.rotate=f.rotate||0),e.scalable&&(d.scaleX=f.scaleX||1,d.scaleY=f.scaleY||1),d},setData:function(c){var d,e,f,g=this.options,h=this.image,i=this.canvas,j={};a.isFunction(c)&&(c=c.call(this.element)),this.isBuilt&&!this.isDisabled&&a.isPlainObject(c)&&(g.rotatable&&b(c.rotate)&&c.rotate!==h.rotate&&(h.rotate=c.rotate,this.isRotated=d=!0),g.scalable&&(b(c.scaleX)&&c.scaleX!==h.scaleX&&(h.scaleX=c.scaleX,e=!0),b(c.scaleY)&&c.scaleY!==h.scaleY&&(h.scaleY=c.scaleY,e=!0)),d?this.renderCanvas():e&&this.renderImage(),f=h.width/h.naturalWidth,b(c.x)&&(j.left=c.x*f+i.left),b(c.y)&&(j.top=c.y*f+i.top),b(c.width)&&(j.width=c.width*f),b(c.height)&&(j.height=c.height*f),this.setCropBoxData(j))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var b=this.canvas,c={};return this.isBuilt&&a.each(["left","top","width","height","naturalWidth","naturalHeight"],function(a,d){c[d]=b[d]}),c},setCanvasData:function(c){var d=this.canvas,e=d.aspectRatio;a.isFunction(c)&&(c=c.call(this.$element)),this.isBuilt&&!this.isDisabled&&a.isPlainObject(c)&&(b(c.left)&&(d.left=c.left),b(c.top)&&(d.top=c.top),b(c.width)?(d.width=c.width,d.height=c.width/e):b(c.height)&&(d.height=c.height,d.width=c.height*e),this.renderCanvas(!0))},getCropBoxData:function(){var a,b=this.cropBox;return this.isBuilt&&this.isCropped&&(a={left:b.left,top:b.top,width:b.width,height:b.height}),a||{}},setCropBoxData:function(c){var d,e,f=this.cropBox,g=this.options.aspectRatio;a.isFunction(c)&&(c=c.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&a.isPlainObject(c)&&(b(c.left)&&(f.left=c.left),b(c.top)&&(f.top=c.top),b(c.width)&&(d=!0,f.width=c.width),b(c.height)&&(e=!0,f.height=c.height),g&&(d?f.height=f.width/g:e&&(f.width=f.height*g)),this.renderCropBox())},getCroppedCanvas:function(b){var c,d,e,f,g,h,i,j,k,m,n;if(this.isBuilt&&ha)return this.isCropped?(a.isPlainObject(b)||(b={}),n=this.getData(),c=n.width,d=n.height,j=c/d,a.isPlainObject(b)&&(g=b.width,h=b.height,g?(h=g/j,i=g/c):h&&(g=h*j,i=h/d)),e=ra(g||c),f=ra(h||d),k=a("<canvas>")[0],k.width=e,k.height=f,m=k.getContext("2d"),b.fillColor&&(m.fillStyle=b.fillColor,m.fillRect(0,0,e,f)),m.drawImage.apply(m,function(){var a,b,e,f,g,h,j=l(this.$clone[0],this.image),k=j.width,m=j.height,o=this.canvas,p=[j],q=n.x+o.naturalWidth*(ma(n.scaleX||1)-1)/2,r=n.y+o.naturalHeight*(ma(n.scaleY||1)-1)/2;return q<=-c||q>k?q=a=e=g=0:q<=0?(e=-q,q=0,a=g=ka(k,c+q)):q<=k&&(e=0,a=g=ka(c,k-q)),a<=0||r<=-d||r>m?r=b=f=h=0:r<=0?(f=-r,r=0,b=h=ka(m,d+r)):r<=m&&(f=0,b=h=ka(d,m-r)),p.push(ra(q),ra(r),ra(a),ra(b)),i&&(e*=i,f*=i,g*=i,h*=i),g>0&&h>0&&p.push(ra(e),ra(f),ra(g),ra(h)),p}.call(this)),k):l(this.$clone[0],this.image)},setAspectRatio:function(a){var b=this.options;this.isDisabled||c(a)||(b.aspectRatio=la(0,a)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(a){var b,c,d=this.options;this.isLoaded&&!this.isDisabled&&(b=a===ea,c=d.movable&&a===fa,a=b||c?a:"none",this.$dragBox.data(_,a).toggleClass(F,b).toggleClass(E,c),d.cropBoxMovable||this.$face.data(_,a).toggleClass(F,b).toggleClass(E,c))}},r.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},r.setDefaults=function(b){a.extend(r.DEFAULTS,b)},r.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',r.other=a.fn.cropper,a.fn.cropper=function(b){var e,f=d(arguments,1);return this.each(function(){var c,d,g=a(this),h=g.data(A);if(!h){if(/destroy/.test(b))return;c=a.extend({},g.data(),a.isPlainObject(b)&&b),g.data(A,h=new r(this,c))}"string"==typeof b&&a.isFunction(d=h[b])&&(e=d.apply(h,f))}),c(e)?this:e},a.fn.cropper.Constructor=r,a.fn.cropper.setDefaults=r.setDefaults,a.fn.cropper.noConflict=function(){return a.fn.cropper=r.other,this}});