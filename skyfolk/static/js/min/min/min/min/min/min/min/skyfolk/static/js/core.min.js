function getCookie(a){var b=null;if(document.cookie&&""!==document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)===a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function AJAX_mark_all_read(){$.ajax({url:"/inbox/notifications/mark-all-as-read/",data:{csrfmiddlewaretoken:csrftoken},type:"POST",success:function(){$("#notification-menu").find("li").fadeOut("fast"),$("#live_notify_badge").html(0)},error:function(a,b){alert("ERROR: "+a.responseText+b)}})}function AJAX_mark_read(a){var b=a.getAttribute("data-notification"),c="/inbox/notifications/mark-as-read/"+b+"/";$.ajax({url:c,data:{csrfmiddlewaretoken:csrftoken},type:"POST",success:function(){$(a).parent().fadeOut("fast");var b=document.getElementById("live_notify_badge");parseInt($(b).html())>0&&$(b).html(parseInt($(b).html())-1)},error:function(a,b){alert("ERROR: "+a.responseText+b)}})}function AJAX_delete_notification(a,b){var c="/inbox/notifications/delete/"+a+"/";$.ajax({url:c,data:{csrfmiddlewaretoken:csrftoken},type:"POST",success:function(){$("ul.list-notifications").find("[data-id='"+b+"']").each(function(){$(this).hide()});var a=document.getElementById("live_notify_badge");parseInt($(a).html())>0&&$(a).html(parseInt($(a).html())-1)},error:function(a,b){}})}function AJAX_addNewFriendByUsernameOrPin(a){$.ajax({type:"POST",url:"/add_friend_by_pin/",data:{valor:a,csrfmiddlewaretoken:csrftoken},dataType:"json",success:function(a){console.log(a);var b=a.response;"added_friend"==b?swal({title:"Success!",text:"You have added a friend!",customClass:"default-div",timer:4e3,showConfirmButton:!0},function(){$("#addfriend").replaceWith('<span class="fa fa-remove" id="addfriend" title="Dejar de seguir" style="color: #29b203;" onclick=AJAX_requestfriend("noabort");> </span>'),a.friend_username&&addItemToFriendList(a.friend_first_name,a.friend_last_name,a.friend_username,a.friend_avatar)}):"your_own_pin"==b?swal({title:"Wait a moment!",text:"It's your own pin!",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"your_own_username"==b?swal({title:"Wait a moment!",text:"It's your own username!",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"its_your_friend"==b?swal({title:"Wait a moment!",text:"It's already your friend!",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"its_blocked"==b?swal({title:"Espera un momento!",text:"Tienes bloqueado este perfil!",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"no_added_friend"==b?swal({title:"We have a problem",text:"Friend no added",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"no_match"==b?swal({title:"We have a problem",text:"This username or pin no exists.",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"in_progress"==b?swal({title:"Request in progress",text:"Your request is to confirm!.",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"new_petition"==b?swal({title:"New petition sent!",text:"Wait to confirm!.",customClass:"default-div",timer:4e3,showConfirmButton:!0}):"user_blocked"==b?swal({title:"Petición denegada.",text:"El usuario te ha bloqueado.",customClass:"default-div",type:"error",timer:4e3,animation:"slide-from-top",showConfirmButton:!1}):"blocked_profile"==b&&swal({title:"Petición denegada.",text:"Tienes bloqueado a este perfil.",customClass:"default-div",type:"error",timer:4e3,animation:"slide-from-top",showConfirmButton:!1})},error:function(a,b){alert(a.responseText+" "+b)}})}function AJAX_respondFriendRequest(a,b,c){$.ajax({type:"POST",url:"/respond_friend_request/",data:{slug:parseInt(a),status:b,csrfmiddlewaretoken:csrftoken},dataType:"json",success:function(a){"added_friend"==a?(addItemToFriendList("Nuevo","nuevo"),sweetAlert("You have added a friend!"),$("li[data-id="+c+"]").fadeOut("fast")):$("li[data-id="+c+"]").fadeOut("fast")},error:function(a,b){alert(a.responseText+" "+b)}})}function AJAX_submit_publication(a,b,c){b=void 0!==b?b:"reply",$.ajax({url:"/publication/",type:"POST",dataType:"json",data:a,success:function(a){var d=a.response;if(console.log("RESPONSE AQUI: "+d+" type: "+b),1==d||swal({title:"",text:"Failed to publish",customClass:"default-div",type:"error"}),"reply"==b){var e=$("#caja-comentario-"+c[2]);$(e).find(".message-reply").val(""),$(e).fadeOut()}else"publication"==b&&$("#page-wrapper, #self-page-wrapper").fadeOut("fast")},error:function(a,b){swal({title:"¡Ups!",text:"Revisa el contenido de tu mensaje",customClass:"default-div",type:"error"})}}).done(function(){})}function AJAX_submit_group(a){$.ajax({url:"/create_group/",type:"POST",dataType:"json",data:a,success:function(a){var b=a.response;console.log("RESPONSE AQUI (grupos): "+b),1==b?$("#create_group").hide():swal({title:"¡Ups!",text:"Fallo al crear el grupo.",customClass:"default-div",type:"error"})},error:function(a,b){swal({title:"¡Ups!",text:"Revisa el contenido de tu grupo.",customClass:"default-div",type:"error"})}}).done(function(){})}function AJAX_requestfriend(a){var b=$("#profileId").html();"noabort"==a?$.ajax({type:"POST",url:"/request_friend/",data:{slug:b,csrfmiddlewaretoken:csrftoken},dataType:"json",success:function(a){"isfriend"==a?swal({title:"¡Ya es tu amigo!",type:"warning",customClass:"default-div",animation:"slide-from-top",showConfirmButton:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Unfollow",cancelButtonText:"Ok, fine!",closeOnConfirm:!0},function(a){a&&AJAX_remove_relationship(b)}):"inprogress"==a?$("#addfriend").replaceWith('<span class="fa fa-clock-o" id="follow_request" title="En proceso" onclick="AJAX_remove_request_friend();"> </span>'):"user_blocked"==a?swal({title:"Petición denegada.",text:"El usuario te ha bloqueado.",customClass:"default-div",type:"error",timer:4e3,animation:"slide-from-top",showConfirmButton:!1}):"added_friend"==a&&$("#addfriend").replaceWith('<span class="fa fa-remove" id="addfriend" title="Dejar de seguir" style="color: #29b203;" onclick=AJAX_requestfriend("noabort");> </span>')},error:function(a,b){alert(a.responseText+" "+b)}}):"anonymous"==a&&alert("Debe estar registrado")}function AJAX_remove_relationship(a){$.ajax({type:"POST",url:"/remove_relationship/",data:{slug:a,csrfmiddlewaretoken:csrftoken},dataType:"json",success:function(a){if(1==a){var b=document.getElementById("followers-stats"),c=document.getElementById("addfriend");$(b).html(parseInt($(b).html())-1),$(c).replaceWith('<span id="addfriend" class="fa fa-plus" title="Seguir" style="color:#555 !important;" onclick=AJAX_requestfriend("noabort");> </span>')}else 0==a&&swal({title:"¡Ups!",text:"Ha surgido un error, inténtalo de nuevo más tarde :-(",customClass:"default-div"})},error:function(a,b){}})}function AJAX_remove_request_friend(){var a=$("#profileId").html();$.ajax({type:"POST",url:"/remove_request_follow/",data:{slug:a,status:"cancel",csrfmiddlewaretoken:csrftoken},dataType:"json",success:function(a){1==a?$("#follow_request").replaceWith('<span id="addfriend" class="fa fa-plus" title="Seguir" onclick=AJAX_requestfriend("noabort");></span>'):0==a&&swal({title:"¡Ups!",text:"Ha surgido un error, inténtalo de nuevo más tarde :-(",customClass:"default-div"})},error:function(a,b){}})}function AJAX_remove_bloq_from_config(a){var b=$(a).data("id");$.ajax({type:"POST",url:"/remove_blocked/",data:{slug:b,csrfmiddlewaretoken:csrftoken},dataType:"json",success:function(a){1==a?$("ul").find("[data-id='"+b+"']").hide():swal({title:"Tenemos un problema...",text:"Hubo un problema con su petición.",customClass:"default-div",timer:4e3,showConfirmButton:!0})},error:function(a,b){alert(a.responseText+" "+b)}})}function is_numeric(a){return/^\d+$/.test(a)}function serializedToJSON(a){a=a.split("&");var b={};for(var c in a)b[a[c].split("=")[0]]=a[c].split("=")[1];return b}var keyPressTimeout;$(window).ready(function(){$("#loader").fadeOut("slow")}),$(document).ready(function(){var a=$("#page-wrapper"),b=$("#self-page-wrapper"),c=$("#group-profile");$("select").material_select(),$("textarea#message2, textarea#message3").characterCounter(),$(".button-menu-left").sideNav({edge:"left",menuWidth:300,draggable:!0}),$(".button-right-notify").sideNav({edge:"right",menuWidth:340,dragable:!0}),$("#publish, #compose-new-no-comments").click(function(){$(a).each(function(){var b=$(this).css("display");$(a).find("#message3").val(""),"none"==b?($(this).fadeOut("slow",function(){$(this).css("display","block")}),$(this).find("#message3").focus()):($(this).find("#message3").blur(),$(this).fadeIn("slow",function(){$(this).css("display","none")}))})}),$("#publish2, #publish3, #compose-self-new-no-comments").click(function(){$(b).each(function(){var a=$(this).css("display");$(b).find("#message2").val(""),"none"==a?($(this).fadeOut("slow",function(){$(this).css("display","block")}),$(this).find("#message2").focus()):($(this).find("#message2").blur(),$(this).fadeIn("slow",function(){$(this).css("display","none")}))})}),$("#new_group").click(function(){$("#create_group").toggle()}),$("#btn_close_group").click(function(){$("#create_group").hide()}),$(a).find("#close").on("click",function(b){b.preventDefault(),$(a).find("#message3").val(""),$(a).hide()}),$(b).find("#close").on("click",function(a){a.preventDefault(),$(b).find("#message2").val(""),$(b).hide()}),$(a).find("#message-form2").on("submit",function(b){b.preventDefault(),AJAX_submit_publication($(a).find("#message-form2").serialize(),"publication")}),$(b).find("#message-form2").on("submit",function(a){a.preventDefault(),AJAX_submit_publication($(b).find("#message-form2").serialize(),"publication")}),$("button.enviar").on("click",function(a){a.preventDefault();var b=$(this).attr("id").split("-")[1],c=$(this).parent();$(c).find("input[name=parent]").val(b);var d=$(c).find("input[name=author]").val(),e=$(c).find("input[name=board_owner]").val();AJAX_submit_publication($(c).serialize(),"reply",[d,e,b])}),$("button#btn_new_group").on("click",function(a){a.preventDefault();var b=$(this).closest("#from_new_group"),c=$(b).find("input[name=owner]").val();console.log(c),AJAX_submit_group($(b).serialize())}),$("#atajos-keyboard-profile").find(".atajos-title .fa-close").on("click",function(){$("#atajos-keyboard-profile").hide()}),$(a).find("#message3").keypress(function(a){!a.ctrlKey&&!a.metaKey||13!=a.keyCode&&10!=a.keyCode||!$(this).is(":visible")||($("#sendformpubli").click(),$(this).val(""),$(this).blur())}),$(b).find("#message2").keypress(function(a){!a.ctrlKey&&!a.metaKey||13!=a.keyCode&&10!=a.keyCode||!$(this).is(":visible")||($("#sendselfformpubli").click(),$(this).val(""),$(this).blur())}),$("#vertical-menu").find(".shortcut-keyboard").on("click",function(){$("#atajos-keyboard-profile").toggle()}),$(this).keypress(function(b){if(109==(b.keyCode||b.which)&&$(a).is(":hidden")&&!$("input").is(":focus")&&!$("textarea").is(":focus"))return $(a).toggle(),$(a).find("#message3").focus(),!1}),$(this).keypress(function(a){if(77==(a.keyCode||a.which)&&$(b).is(":hidden")&&!$("input").is(":focus")&&!$("textarea").is(":focus"))return $(b).toggle(),$(b).find("#message2").focus(),!1}),$(this).keypress(function(a){var b=a.keyCode||a.which,c=document.getElementById("atajos-keyboard-profile");97!=b||!$(c).is(":hidden")||$("input").is(":focus")||$("textarea").is(":focus")||$(c).show()}),$(this).on("keydown",function(c){if(27===(c.keyCode||c.which)){var d=document.getElementsByClassName("ampliado"),e=document.getElementById("atajos-keyboard-profile"),f=document.getElementsByClassName("info-paw"),g=document.getElementById("id_searchText"),h=$(a).find("#message3"),i=$(b).find("#message2");$(i).blur(),$(i).val(""),$(a).hide(),$(h).blur(),$(h).val(""),$(b).hide(),$(e).hide(),$(d).hide(),$(f).hide(),$("#create_group").hide(),$(g).val(""),$(g).blur(),$(".side-nav").sideNav("hide")}}),$(this).on("keydown",function(a){if(111===a.keyCode&&$("#atajos-keyboard-profile").is(":hidden")&&!$("input").is(":focus")&&!$("textarea").is(":focus"))return $("#id_searchText").focus(),!1}),$("#clear-notify").on("click",function(){AJAX_mark_all_read()}),$("#agregar-amigo, #agregar-amigo2").on("click",function(){swal({title:"Add new friend!",customClass:"default-div",text:"Insert the friend's username or PIN",type:"input",animation:"slide-from-top",showConfirmButton:!0,showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Add it!",cancelButtonText:"Cancel!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(a){return!1!==a&&(""===a?(swal.showInputError("You need to write something!"),!1):void AJAX_addNewFriendByUsernameOrPin(a))})}),$(c).on("click","#follow-group",function(a){a.preventDefault();var b=$(c).attr("data-id");return AJAX_follow_group(b),!1}),$(c).on("click","#unfollow-group",function(a){a.preventDefault();var b=$(c).attr("data-id");return AJAX_unfollow_group(b),!1}),$(c).on("click","#like-group",function(a){a.preventDefault();var b=$(c).attr("data-id");return AJAX_like_group(b),!1}),$("#id_searchText").on("keydown",function(a){clearTimeout(keyPressTimeout),keyPressTimeout=setTimeout(function(){var a={value:$("#id_searchText").val()};$.ajax({url:"/pre_search/users/",type:"GET",dataType:"json",data:a,success:function(a){$("#id_searchText").atwho({at:"",searchKey:"username",insertTpl:"${username}",displayTpl:"<li data-value='(${username}, ${username})'><img src='${avatar}' width='30px' height='30px'> ${username} <small>${first_name} ${last_name}</small></li>",data:a.result,limit:20,callback:{filter:function(a,b,c){return $.map(b,function(b,d){return b[c].toLowerCase().indexOf(a)<0?null:b})}}})}})},250)})});var csrftoken=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(a,b){csrfSafeMethod(b.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",csrftoken)}});